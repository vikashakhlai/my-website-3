<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Soft Oasis Sound Generator</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      height: 100vh;
      background: #f2f1ff;
    }
    button {
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background: #6366f1;
      color: white;
      transition: 0.2s;
    }
    button:hover {
      background: #4f46e5;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <h2>üéµ Generate Oasis Sounds</h2>
  <button onclick="generateCorrect()">Download correct.mp3 ‚úÖ</button>
  <button onclick="generateWrong()">Download wrong.mp3 ‚ùå</button>

  <script>
    async function createSound(frequencies, duration = 0.5, volume = 0.7) {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const sampleRate = ctx.sampleRate;
      const buffer = ctx.createBuffer(1, sampleRate * duration, sampleRate);
      const data = buffer.getChannelData(0);

      const length = buffer.length;
      const step = length / frequencies.length;

      for (let i = 0; i < frequencies.length; i++) {
        const freq = frequencies[i];
        for (let j = 0; j < step; j++) {
          const index = Math.floor(i * step + j);
          const t = index / sampleRate;

          // –º—è–≥–∫–∞—è —Å–∏–Ω—É—Å–æ–∏–¥–∞ —Å –ª—ë–≥–∫–æ–π –≤–∏–±—Ä–∞—Ü–∏–µ–π
          const vibrato = Math.sin(2 * Math.PI * 5 * t) * 0.02;
          data[index] =
            Math.sin(2 * Math.PI * (freq + freq * vibrato) * t) *
            volume *
            Math.exp(-3 * t); // –ø–ª–∞–≤–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ
        }
      }

      const offline = new OfflineAudioContext(1, length, sampleRate);
      const src = offline.createBufferSource();
      src.buffer = buffer;
      src.connect(offline.destination);
      src.start();

      const rendered = await offline.startRendering();
      const wav = audioBufferToWav(rendered);
      return new Blob([new DataView(wav)], { type: "audio/mp3" });
    }

    function audioBufferToWav(buffer) {
      let numOfChan = buffer.numberOfChannels,
        length = buffer.length * numOfChan * 2 + 44,
        buffer2 = new ArrayBuffer(length),
        view = new DataView(buffer2),
        channels = [],
        sample,
        offset = 0,
        pos = 0;

      function setUint16(data) {
        view.setUint16(pos, data, true);
        pos += 2;
      }
      function setUint32(data) {
        view.setUint32(pos, data, true);
        pos += 4;
      }

      setUint32(0x46464952);
      setUint32(length - 8);
      setUint32(0x45564157);
      setUint32(0x20746d66);
      setUint32(16);
      setUint16(1);
      setUint16(numOfChan);
      setUint32(buffer.sampleRate);
      setUint32(buffer.sampleRate * 2 * numOfChan);
      setUint16(numOfChan * 2);
      setUint16(16);
      setUint32(0x61746164);
      setUint32(length - pos - 4);

      for (let i = 0; i < numOfChan; i++)
        channels.push(buffer.getChannelData(i));

      while (pos < length) {
        for (let i = 0; i < numOfChan; i++) {
          sample = Math.max(-1, Math.min(1, channels[i][offset]));
          sample = (0.5 + sample * 32767) | 0;
          view.setInt16(pos, sample, true);
          pos += 2;
        }
        offset++;
      }
      return buffer2;
    }

    async function download(blob, name) {
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = name;
      a.click();
      URL.revokeObjectURL(url);
    }

    async function generateCorrect() {
  // –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–∞—è, –º–µ–ª–æ–¥–∏—á–Ω–∞—è –≤–æ—Å—Ç–æ—á–Ω–∞—è –≥–∞–º–º–∞
  const blob = await createSound(
    [330, 415, 494, 523, 415], // –Ω–æ—Ç—ã
    1.1, // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    0.55 // –≥—Ä–æ–º–∫–æ—Å—Ç—å
  );
  download(blob, "correct.mp3");
}


    async function generateWrong() {
      // –Ω–µ —Ä–µ–∑–∫–∏–π, "–ø–µ—á–∞–ª—å–Ω—ã–π", –ø–ª–∞–≤–Ω—ã–π –Ω–∏–∑–∫–∏–π —Å–ø–∞–¥
      const blob = await createSound([300, 240, 180], 0.6, 0.5);
      download(blob, "wrong.mp3");
    }
  </script>
</body>
</html>
